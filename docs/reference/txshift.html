<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Efficient Estimate of Counterfactual Mean of Stochastic Shift Intervention — txshift • txshift</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Efficient Estimate of Counterfactual Mean of Stochastic Shift Intervention — txshift"><meta property="og:description" content="Efficient Estimate of Counterfactual Mean of Stochastic Shift Intervention"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">txshift</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/intro_txshift.html">Evaluating Causal Effects of Modified Treatment Policies</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/nhejazi/txshift/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Efficient Estimate of Counterfactual Mean of Stochastic Shift Intervention</h1>
    <small class="dont-index">Source: <a href="https://github.com/nhejazi/txshift/blob/HEAD/R/txshift.R" class="external-link"><code>R/txshift.R</code></a></small>
    <div class="hidden name"><code>txshift.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Efficient Estimate of Counterfactual Mean of Stochastic Shift Intervention</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">txshift</span><span class="op">(</span></span>
<span>  <span class="va">W</span>,</span>
<span>  <span class="va">A</span>,</span>
<span>  C_cens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">Y</span>,</span>
<span>  C_samp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  V <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  delta <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  estimator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tmle"</span>, <span class="st">"onestep"</span><span class="op">)</span>,</span>
<span>  fluctuation <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"standard"</span>, <span class="st">"weighted"</span><span class="op">)</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  gps_bound <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  samp_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fit_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm"</span>, <span class="st">"sl"</span>, <span class="st">"external"</span><span class="op">)</span>, sl_learners <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  g_exp_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fit_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hal"</span>, <span class="st">"sl"</span>, <span class="st">"external"</span><span class="op">)</span>, lambda_seq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,</span>
<span>    <span class="op">-</span><span class="fl">13</span>, length <span class="op">=</span> <span class="fl">300</span><span class="op">)</span><span class="op">)</span>, sl_learners_density <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  g_cens_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fit_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm"</span>, <span class="st">"sl"</span>, <span class="st">"external"</span><span class="op">)</span>, glm_formula <span class="op">=</span></span>
<span>    <span class="st">"C_cens ~ .^2"</span>, sl_learners <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  Q_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fit_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"glm"</span>, <span class="st">"sl"</span>, <span class="st">"external"</span><span class="op">)</span>, glm_formula <span class="op">=</span> <span class="st">"Y ~ .^2"</span>,</span>
<span>    sl_learners <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,</span>
<span>  eif_reg_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hal"</span>, <span class="st">"glm"</span><span class="op">)</span>,</span>
<span>  ipcw_efficiency <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  samp_fit_ext <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gn_exp_fit_ext <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  gn_cens_fit_ext <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  Qn_fit_ext <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-w">W<a class="anchor" aria-label="anchor" href="#arg-w"></a></dt>
<dd><p>A <code>matrix</code>, <code>data.frame</code>, or similar containing a set of
baseline covariates.</p></dd>


<dt id="arg-a">A<a class="anchor" aria-label="anchor" href="#arg-a"></a></dt>
<dd><p>A <code>numeric</code> vector corresponding to a treatment variable. The
parameter of interest is defined as a location shift of this quantity.</p></dd>


<dt id="arg-c-cens">C_cens<a class="anchor" aria-label="anchor" href="#arg-c-cens"></a></dt>
<dd><p>A <code>numeric</code> indicator for whether a given observation was
subject to censoring by way of loss to follow-up. The default assumes no
censoring due to loss to follow-up.</p></dd>


<dt id="arg-y">Y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>A <code>numeric</code> vector of the observed outcomes.</p></dd>


<dt id="arg-c-samp">C_samp<a class="anchor" aria-label="anchor" href="#arg-c-samp"></a></dt>
<dd><p>A <code>numeric</code> indicator for whether a given observation was
subject to censoring by being omitted from the second-stage sample, used to
compute an inverse probability of censoring weighted estimator in such
cases. The default assumes no censoring due to two-phase sampling.</p></dd>


<dt id="arg-v">V<a class="anchor" aria-label="anchor" href="#arg-v"></a></dt>
<dd><p>The covariates that are used in determining the sampling procedure
that gives rise to censoring. The default is <code>NULL</code> and corresponds to
scenarios in which there is no censoring (in which case all values in the
preceding argument <code>C_samp</code> must be uniquely 1). To specify this, pass
in a <code>character</code> vector identifying variables amongst W, A, Y thought
to have impacted the definition of the sampling mechanism (C_samp). This
argument also accepts a <code>data.table</code> (or similar) object composed of
combinations of variables W, A, Y; use of this option is NOT recommended.</p></dd>


<dt id="arg-delta">delta<a class="anchor" aria-label="anchor" href="#arg-delta"></a></dt>
<dd><p>A <code>numeric</code> value indicating the shift in the treatment to
be used in defining the target parameter. This is defined with respect to
the scale of the treatment (A).</p></dd>


<dt id="arg-estimator">estimator<a class="anchor" aria-label="anchor" href="#arg-estimator"></a></dt>
<dd><p>The type of estimator to be fit, either <code>"tmle"</code> for
targeted maximum likelihood or <code>"onestep"</code> for a one-step estimator.</p></dd>


<dt id="arg-fluctuation">fluctuation<a class="anchor" aria-label="anchor" href="#arg-fluctuation"></a></dt>
<dd><p>The method to be used in the submodel fluctuation step
(targeting step) to compute the TML estimator. The choices are "standard"
and "weighted" for where to place the auxiliary covariate in the logistic
tilting regression.</p></dd>


<dt id="arg-max-iter">max_iter<a class="anchor" aria-label="anchor" href="#arg-max-iter"></a></dt>
<dd><p>A <code>numeric</code> integer giving the maximum number of steps
to be taken in iterating to a solution of the efficient influence function.</p></dd>


<dt id="arg-gps-bound">gps_bound<a class="anchor" aria-label="anchor" href="#arg-gps-bound"></a></dt>
<dd><p><code>numeric</code> giving the lower limit of the generalized
propensity score estimates to be tolerated (default = 0.01). Estimates
falling below this value are truncated to this or 1/n. For details, see
<code><a href="bound_propensity.html">bound_propensity</a></code>.</p></dd>


<dt id="arg-samp-fit-args">samp_fit_args<a class="anchor" aria-label="anchor" href="#arg-samp-fit-args"></a></dt>
<dd><p>A <code>list</code> of arguments, all but one of which are
passed to <code><a href="est_samp.html">est_samp</a></code>. For details, consult the documentation of
<code><a href="est_samp.html">est_samp</a></code>. The first element (i.e., <code>fit_type</code>) is used
to determine how this regression is fit: generalized linear model ("glm")
or Super Learner ("sl"), and "external" a user-specified input of the form
produced by <code><a href="est_samp.html">est_samp</a></code>.</p></dd>


<dt id="arg-g-exp-fit-args">g_exp_fit_args<a class="anchor" aria-label="anchor" href="#arg-g-exp-fit-args"></a></dt>
<dd><p>A <code>list</code> of arguments, all but one of which are
passed to <code><a href="est_g_exp.html">est_g_exp</a></code>. For details, see the documentation of
<code><a href="est_g_exp.html">est_g_exp</a></code>. The 1st element (i.e., <code>fit_type</code>) specifies
how this regression is fit: <code>"hal"</code> to estimate conditional densities
via the highly adaptive lasso (via <span class="pkg">haldensify</span>), <code>"sl"</code> for
<span class="pkg">sl3</span> learners used to fit Super Learner ensembles to densities via
<span class="pkg">sl3</span>'s <code>Lrnr_haldensify</code> or similar, and <code>"external"</code> for
user-specified input of the form produced by <code><a href="est_g_exp.html">est_g_exp</a></code>.</p></dd>


<dt id="arg-g-cens-fit-args">g_cens_fit_args<a class="anchor" aria-label="anchor" href="#arg-g-cens-fit-args"></a></dt>
<dd><p>A <code>list</code> of arguments, all but one of which are
passed to <code><a href="est_g_cens.html">est_g_cens</a></code>. For details, see the documentation of
<code><a href="est_g_cens.html">est_g_cens</a></code>. The 1st element (i.e., <code>fit_type</code>) specifies
how this regression is fit: <code>"glm"</code> for a generalized linear model
or <code>"sl"</code> for <span class="pkg">sl3</span> learners used to fit a Super Learner ensemble
for the censoring mechanism, and <code>"external"</code> for user-specified input
of the form produced by <code><a href="est_g_cens.html">est_g_cens</a></code>.</p></dd>


<dt id="arg-q-fit-args">Q_fit_args<a class="anchor" aria-label="anchor" href="#arg-q-fit-args"></a></dt>
<dd><p>A <code>list</code> of arguments, all but one of which are
passed to <code><a href="est_Q.html">est_Q</a></code>. For details, consult the documentation for
<code><a href="est_Q.html">est_Q</a></code>. The first element (i.e., <code>fit_type</code>) is used to
determine how this regression is fit: <code>"glm"</code> for a generalized linear
model for the outcome mechanism, <code>"sl"</code> for <span class="pkg">sl3</span> learners used
to fit a Super Learner for the outcome mechanism, and <code>"external"</code>
for user-specified input of the form produced by <code><a href="est_Q.html">est_Q</a></code>.</p></dd>


<dt id="arg-eif-reg-type">eif_reg_type<a class="anchor" aria-label="anchor" href="#arg-eif-reg-type"></a></dt>
<dd><p>Whether a flexible nonparametric function ought to be
used in the dimension-reduced nuisance regression of the targeting step for
the censored data case. By default, the method used is a nonparametric
regression based on the Highly Adaptive Lasso (from <span class="pkg">hal9001</span>). Set
this to <code>"glm"</code> to instead use a simple linear regression model. In
this step, the efficient influence function (EIF) is regressed against
covariates contributing to the censoring mechanism (i.e., EIF ~ V | C = 1).</p></dd>


<dt id="arg-ipcw-efficiency">ipcw_efficiency<a class="anchor" aria-label="anchor" href="#arg-ipcw-efficiency"></a></dt>
<dd><p>Whether to use an augmented inverse probability of
censoring weighted EIF estimating equation to ensure efficiency of the
resultant estimate. The default is <code>TRUE</code>; the inefficient estimation
procedure specified by <code>FALSE</code> is only supported for completeness.</p></dd>


<dt id="arg-samp-fit-ext">samp_fit_ext<a class="anchor" aria-label="anchor" href="#arg-samp-fit-ext"></a></dt>
<dd><p>The results of an external fitting procedure used to
estimate the two-phase sampling mechanism, to be used in constructing the
inverse probability of censoring weighted TML or one-step estimator. The
input provided must match the output of <code><a href="est_samp.html">est_samp</a></code> exactly.</p></dd>


<dt id="arg-gn-exp-fit-ext">gn_exp_fit_ext<a class="anchor" aria-label="anchor" href="#arg-gn-exp-fit-ext"></a></dt>
<dd><p>The results of an external fitting procedure used to
estimate the exposure mechanism (generalized propensity score), to be used
in constructing the TML or one-step estimator. The input provided must
match the output of <code><a href="est_g_exp.html">est_g_exp</a></code> exactly.</p></dd>


<dt id="arg-gn-cens-fit-ext">gn_cens_fit_ext<a class="anchor" aria-label="anchor" href="#arg-gn-cens-fit-ext"></a></dt>
<dd><p>The results of an external fitting procedure used to
estimate the censoring mechanism (propensity score for missingness), to be
used in constructing the TML or one-step estimator. The input provided must
match the output of <code><a href="est_g_cens.html">est_g_cens</a></code> exactly.</p></dd>


<dt id="arg-qn-fit-ext">Qn_fit_ext<a class="anchor" aria-label="anchor" href="#arg-qn-fit-ext"></a></dt>
<dd><p>The results of an external fitting procedure used to
estimate the outcome mechanism, to be used in constructing the TML or
one-step estimator. The input provided must match the output of
<code><a href="est_Q.html">est_Q</a></code> exactly; use of this argument is only recommended for
power users.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>S3 object of class <code>txshift</code> containing the results of the
 procedure to compute a TML or one-step estimate of the counterfactual mean
 under a modified treatment policy that shifts a continuous-valued exposure
 by a scalar amount <code>delta</code>. These estimates can be augmented to be
 consistent and efficient when two-phase sampling is performed.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Construct a one-step estimate or targeted minimum loss estimate of
 the counterfactual mean under a modified treatment policy, automatically
 making adjustments for two-phase sampling when a censoring indicator is
 included. Ensemble machine learning may be used to construct the initial
 estimates of nuisance functions using <span class="pkg">sl3</span>.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">429153</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">n_obs</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span><span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_obs</span>, mean <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">W</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">A</span> <span class="op">+</span> <span class="va">W</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_obs</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">C_samp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="va">W</span> <span class="op">+</span> <span class="va">Y</span><span class="op">)</span><span class="op">)</span> <span class="co"># two-phase sampling</span></span></span>
<span class="r-in"><span><span class="va">C_cens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">W</span><span class="op">)</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># construct a TML estimate, ignoring censoring</span></span></span>
<span class="r-in"><span><span class="va">tmle</span> <span class="op">&lt;-</span> <span class="fu">txshift</span><span class="op">(</span></span></span>
<span class="r-in"><span>  W <span class="op">=</span> <span class="va">W</span>, A <span class="op">=</span> <span class="va">A</span>, Y <span class="op">=</span> <span class="va">Y</span>, delta <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>  estimator <span class="op">=</span> <span class="st">"onestep"</span>,</span></span>
<span class="r-in"><span>  g_exp_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    fit_type <span class="op">=</span> <span class="st">"hal"</span>,</span></span>
<span class="r-in"><span>    n_bins <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>    lambda_seq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">10</span>, length <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  Q_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    fit_type <span class="op">=</span> <span class="st">"glm"</span>,</span></span>
<span class="r-in"><span>    glm_formula <span class="op">=</span> <span class="st">"Y ~ ."</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Some fit_control arguments are neither default nor glmnet/cv.glmnet arguments: n_folds; </span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> They will be removed from fit_control</span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># construct a TML estimate, accounting for censoring</span></span></span>
<span class="r-in"><span><span class="va">tmle</span> <span class="op">&lt;-</span> <span class="fu">txshift</span><span class="op">(</span></span></span>
<span class="r-in"><span>  W <span class="op">=</span> <span class="va">W</span>, A <span class="op">=</span> <span class="va">A</span>, C_cens <span class="op">=</span> <span class="va">C_cens</span>, Y <span class="op">=</span> <span class="va">Y</span>, delta <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>  estimator <span class="op">=</span> <span class="st">"onestep"</span>,</span></span>
<span class="r-in"><span>  g_exp_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    fit_type <span class="op">=</span> <span class="st">"hal"</span>,</span></span>
<span class="r-in"><span>    n_bins <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>    lambda_seq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">10</span>, length <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  g_cens_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    fit_type <span class="op">=</span> <span class="st">"glm"</span>,</span></span>
<span class="r-in"><span>    glm_formula <span class="op">=</span> <span class="st">"C_cens ~ ."</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  Q_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    fit_type <span class="op">=</span> <span class="st">"glm"</span>,</span></span>
<span class="r-in"><span>    glm_formula <span class="op">=</span> <span class="st">"Y ~ ."</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># construct a TML estimate under two-phase sampling, ignoring censoring</span></span></span>
<span class="r-in"><span><span class="va">ipcwtmle</span> <span class="op">&lt;-</span> <span class="fu">txshift</span><span class="op">(</span></span></span>
<span class="r-in"><span>  W <span class="op">=</span> <span class="va">W</span>, A <span class="op">=</span> <span class="va">A</span>, Y <span class="op">=</span> <span class="va">Y</span>, delta <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>  C_samp <span class="op">=</span> <span class="va">C_samp</span>, V <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"W"</span>, <span class="st">"Y"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  estimator <span class="op">=</span> <span class="st">"onestep"</span>, max_iter <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  samp_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fit_type <span class="op">=</span> <span class="st">"glm"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  g_exp_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    fit_type <span class="op">=</span> <span class="st">"hal"</span>,</span></span>
<span class="r-in"><span>    n_bins <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>    lambda_seq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">10</span>, length <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  Q_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    fit_type <span class="op">=</span> <span class="st">"glm"</span>,</span></span>
<span class="r-in"><span>    glm_formula <span class="op">=</span> <span class="st">"Y ~ ."</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  eif_reg_type <span class="op">=</span> <span class="st">"glm"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># construct a TML estimate acconting for two-phase sampling and censoring</span></span></span>
<span class="r-in"><span><span class="va">ipcwtmle</span> <span class="op">&lt;-</span> <span class="fu">txshift</span><span class="op">(</span></span></span>
<span class="r-in"><span>  W <span class="op">=</span> <span class="va">W</span>, A <span class="op">=</span> <span class="va">A</span>, C_cens <span class="op">=</span> <span class="va">C_cens</span>, Y <span class="op">=</span> <span class="va">Y</span>, delta <span class="op">=</span> <span class="fl">0.5</span>,</span></span>
<span class="r-in"><span>  C_samp <span class="op">=</span> <span class="va">C_samp</span>, V <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"W"</span>, <span class="st">"Y"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  estimator <span class="op">=</span> <span class="st">"onestep"</span>, max_iter <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>  samp_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fit_type <span class="op">=</span> <span class="st">"glm"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  g_exp_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    fit_type <span class="op">=</span> <span class="st">"hal"</span>,</span></span>
<span class="r-in"><span>    n_bins <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>    lambda_seq <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">10</span>, length <span class="op">=</span> <span class="fl">50</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  g_cens_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    fit_type <span class="op">=</span> <span class="st">"glm"</span>,</span></span>
<span class="r-in"><span>    glm_formula <span class="op">=</span> <span class="st">"C_cens ~ ."</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  Q_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    fit_type <span class="op">=</span> <span class="st">"glm"</span>,</span></span>
<span class="r-in"><span>    glm_formula <span class="op">=</span> <span class="st">"Y ~ ."</span></span></span>
<span class="r-in"><span>  <span class="op">)</span>,</span></span>
<span class="r-in"><span>  eif_reg_type <span class="op">=</span> <span class="st">"glm"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Nima Hejazi, David Benkeser.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

