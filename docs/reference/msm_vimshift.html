<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Working marginal structural model for causal effects of an intervention grid — msm_vimshift • txshift</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Working marginal structural model for causal effects of an intervention grid — msm_vimshift"><meta property="og:description" content="Working marginal structural model for causal effects of an intervention grid"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">txshift</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.9</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/intro_txshift.html">Evaluating Causal Effects of Modified Treatment Policies</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/nhejazi/txshift/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Working marginal structural model for causal effects of an intervention grid</h1>
    <small class="dont-index">Source: <a href="https://github.com/nhejazi/txshift/blob/HEAD/R/msm.R" class="external-link"><code>R/msm.R</code></a></small>
    <div class="hidden name"><code>msm_vimshift.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Working marginal structural model for causal effects of an intervention grid</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">msm_vimshift</span><span class="op">(</span></span>
<span>  <span class="va">W</span>,</span>
<span>  <span class="va">A</span>,</span>
<span>  C_cens <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="va">Y</span>,</span>
<span>  C_samp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  V <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  delta_grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span><span class="op">)</span>,</span>
<span>  msm_form <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"linear"</span>, knot <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span>,</span>
<span>  estimator <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tmle"</span>, <span class="st">"onestep"</span><span class="op">)</span>,</span>
<span>  weighting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"identity"</span>, <span class="st">"variance"</span><span class="op">)</span>,</span>
<span>  ci_level <span class="op">=</span> <span class="fl">0.95</span>,</span>
<span>  ci_type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"marginal"</span>, <span class="st">"simultaneous"</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>


<dl><dt id="arg-w">W<a class="anchor" aria-label="anchor" href="#arg-w"></a></dt>
<dd><p>A <code>matrix</code>, <code>data.frame</code>, or similar containing a set of
baseline covariates.</p></dd>


<dt id="arg-a">A<a class="anchor" aria-label="anchor" href="#arg-a"></a></dt>
<dd><p>A <code>numeric</code> vector corresponding to a treatment variable. The
parameter of interest is defined as a location shift of this quantity.</p></dd>


<dt id="arg-c-cens">C_cens<a class="anchor" aria-label="anchor" href="#arg-c-cens"></a></dt>
<dd><p>A <code>numeric</code> indicator for whether a given observation was
subject to censoring by way of loss to follow-up. The default assumes no
censoring due to loss to follow-up.</p></dd>


<dt id="arg-y">Y<a class="anchor" aria-label="anchor" href="#arg-y"></a></dt>
<dd><p>A <code>numeric</code> vector of the observed outcomes.</p></dd>


<dt id="arg-c-samp">C_samp<a class="anchor" aria-label="anchor" href="#arg-c-samp"></a></dt>
<dd><p>A <code>numeric</code> indicator for whether a given observation was
subject to censoring by being omitted from the second-stage sample, used to
compute an inverse probability of censoring weighted estimator in such
cases. The default assumes no censoring due to two-phase sampling.</p></dd>


<dt id="arg-v">V<a class="anchor" aria-label="anchor" href="#arg-v"></a></dt>
<dd><p>The covariates that are used in determining the sampling procedure
that gives rise to censoring. The default is <code>NULL</code> and corresponds to
scenarios in which there is no censoring (in which case all values in the
preceding argument <code>C</code> must be uniquely 1. To specify this, pass in a
NAMED <code>list</code> identifying variables amongst W, A, Y that are thought to
have played a role in defining the sampling/censoring mechanism (C).</p></dd>


<dt id="arg-delta-grid">delta_grid<a class="anchor" aria-label="anchor" href="#arg-delta-grid"></a></dt>
<dd><p>A <code>numeric</code> vector giving the individual values of
the shift parameter used in computing each of the estimates.</p></dd>


<dt id="arg-msm-form">msm_form<a class="anchor" aria-label="anchor" href="#arg-msm-form"></a></dt>
<dd><p>A <code>list</code> specifying the type of working MSM to fit to
summarize the counterfactual means. The <code>list</code> has two components:
(1) <code>"type"</code>, which may be either "linear" or "piecewise", and (2)
<code>"knot"</code>, which, if specified, must be a value in <code>delta_grid</code>.
See examples for its use.</p></dd>


<dt id="arg-estimator">estimator<a class="anchor" aria-label="anchor" href="#arg-estimator"></a></dt>
<dd><p>The type of estimator to be fit, either <code>"tmle"</code> for
targeted maximum likelihood estimation or <code>"onestep"</code> for a one-step
augmented inverse probability weighted (AIPW) estimator.</p></dd>


<dt id="arg-weighting">weighting<a class="anchor" aria-label="anchor" href="#arg-weighting"></a></dt>
<dd><p>Whether to weight each parameter estimate by the inverse of
its variance (in order to improve stability of the resultant MSM fit) or to
simply weight all parameter estimates equally. The default is the option
<code>"identity"</code>, weighting all estimates identically.</p></dd>


<dt id="arg-ci-level">ci_level<a class="anchor" aria-label="anchor" href="#arg-ci-level"></a></dt>
<dd><p>A <code>numeric</code> indicating the desired coverage level of
the confidence interval to be computed.</p></dd>


<dt id="arg-ci-type">ci_type<a class="anchor" aria-label="anchor" href="#arg-ci-type"></a></dt>
<dd><p>Whether to construct a simultaneous confidence band covering
all parameter estimates at once or marginal confidence intervals covering
each parameter estimate separately. The default is to construct marginal
confidence intervals for each parameter estimate rather than a simultaneous
confidence band.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments to be passed to <code><a href="txshift.html">txshift</a></code>.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>A <code>list</code> containing estimates of the individual counterfactual
 means over a grid in the shift parameters (<code>delta_grid</code>), alongside
 the estimate of a marginal structural model that summarizes a trend through
 these counterfactual means.</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>Computes estimates of the counterfactual mean over a grid of shift
 stochastic interventions and fits a working marginal structural model to
 summarize the trend through the counterfactual means as a function of the
 specified shift intervention. The working marginal structural model may be
 linear in the shift parameter or piecewise linear with a single knot point.
 Provides support for two weighting schemes, may be used with either of the
 one-step or TML estimators, and also allows the construction of marginal or
 simultaneous confidence intervals.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="st"><a href="https://tlverse.org/sl3" class="external-link">"sl3"</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span>  <span class="va">n_obs</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span>  <span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_obs</span>, mean <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">W</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">A</span> <span class="op">-</span> <span class="va">W</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">msm</span> <span class="op">&lt;-</span> <span class="fu">msm_vimshift</span><span class="op">(</span></span></span>
<span class="r-in"><span>    W <span class="op">=</span> <span class="va">W</span>, A <span class="op">=</span> <span class="va">A</span>, Y <span class="op">=</span> <span class="va">Y</span>, estimator <span class="op">=</span> <span class="st">"tmle"</span>,</span></span>
<span class="r-in"><span>    g_exp_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      fit_type <span class="op">=</span> <span class="st">"sl"</span>,</span></span>
<span class="r-in"><span>      sl_learners_density <span class="op">=</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_density_hse.html" class="external-link">Lrnr_density_hse</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glm.html" class="external-link">Lrnr_glm</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    Q_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      fit_type <span class="op">=</span> <span class="st">"glm"</span>,</span></span>
<span class="r-in"><span>      glm_formula <span class="op">=</span> <span class="st">"Y ~ ."</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    delta_grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span>  <span class="co"># fit a linear spline with knot at 0</span></span></span>
<span class="r-in"><span>  <span class="va">n_obs</span> <span class="op">&lt;-</span> <span class="fl">100</span></span></span>
<span class="r-in"><span>  <span class="va">W</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n_obs</span>, mean <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">W</span>, sd <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">n_obs</span>, <span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/stats/Logistic.html" class="external-link">plogis</a></span><span class="op">(</span><span class="fl">0.1</span> <span class="op">*</span> <span class="va">A</span> <span class="op">*</span> <span class="op">(</span><span class="va">A</span> <span class="op">&gt;=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">-</span> <span class="fl">3</span> <span class="op">*</span> <span class="va">A</span> <span class="op">*</span> <span class="op">(</span><span class="va">A</span> <span class="op">&lt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op">-</span> <span class="va">W</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="va">msm</span> <span class="op">&lt;-</span> <span class="fu">msm_vimshift</span><span class="op">(</span></span></span>
<span class="r-in"><span>    W <span class="op">=</span> <span class="va">W</span>, A <span class="op">=</span> <span class="va">A</span>, Y <span class="op">=</span> <span class="va">Y</span>, estimator <span class="op">=</span> <span class="st">"tmle"</span>,</span></span>
<span class="r-in"><span>    g_exp_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      fit_type <span class="op">=</span> <span class="st">"sl"</span>,</span></span>
<span class="r-in"><span>      sl_learners_density <span class="op">=</span> <span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_density_hse.html" class="external-link">Lrnr_density_hse</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="va"><a href="https://tlverse.org/sl3/reference/Lrnr_glm.html" class="external-link">Lrnr_glm</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    Q_fit_args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>      fit_type <span class="op">=</span> <span class="st">"glm"</span>,</span></span>
<span class="r-in"><span>      glm_formula <span class="op">=</span> <span class="st">"Y ~ ."</span></span></span>
<span class="r-in"><span>    <span class="op">)</span>,</span></span>
<span class="r-in"><span>    delta_grid <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0.25</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>    msm_form <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"piecewise"</span>, knot <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Loading required package: sl3</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Nima Hejazi, David Benkeser.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer></div>






  </body></html>

